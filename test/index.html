<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Unit Tests</title>
    <link rel="stylesheet" href="https://unpkg.com/mocha/mocha.css" />
</head>
<body>
    <div id="mocha"></div>
    
    <div style="margin: 20px; padding: 10px; border: 1px solid #ccc; background: #f5f5f5;">
        <h3>测试结果输出 (用于复制给 AI):</h3>
        <textarea id="test-result-output" style="width: 100%; height: 150px; font-family: monospace;" readonly>正在运行测试...</textarea>
    </div>

    <script src="https://unpkg.com/chai@4.5.0/chai.js"></script>
    <script src="https://unpkg.com/mocha/mocha.js"></script>

    <script>
        window.perfResults = [];
        window.logPerf = function(msg) {
            window.perfResults.push(msg);
            console.log(msg);
        }
    </script>

    <script class="mocha-init">
        mocha.setup('bdd');
        mocha.checkLeaks();
    </script>
    
    <script type="module" src="./tests.js"></script>
    
    <script type="module">
        const runner = mocha.run();
        const results = [];
        
        runner.on('pass', function(test) {
            results.push(`✅ PASS: ${test.fullTitle()}`);
        });

        runner.on('fail', function(test, err) {
            results.push(`❌ FAIL: ${test.fullTitle()}\n   Error: ${err.message}`);
        });

        runner.on('end', function() {
            const output = document.getElementById('test-result-output');
            const stats = this.stats;
            const summary = `测试完成。\n通过: ${stats.passes}\n失败: ${stats.failures}\n总计: ${stats.tests}\n耗时: ${stats.duration}ms`;
            
            const perfOutput = window.perfResults.length > 0 ? '\n\n性能测试结果:\n' + window.perfResults.join('\n') : '';

            output.value = summary + perfOutput + '\n\n详细结果:\n' + results.join('\n');
        });
    </script>
</body>
</html>